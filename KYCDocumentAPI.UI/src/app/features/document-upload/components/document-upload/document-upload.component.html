<div class="upload-container">
  <h2 class="title">KYC Document Classification & Extraction</h2>
  <!-- Upload Form -->
  <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" novalidate>
    <!-- File Input Section with Drag & Drop -->
    <div class="form-group">
      <!-- Drag and Drop Zone -->
      <div
        class="drag-drop-zone"
        [class.drag-over]="isDragOver"
        [class.has-file]="selectedFile"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
      >
        <div class="drag-drop-content">
          <div class="upload-icon">üìÅ</div>
          <div class="drag-drop-text">
            <span class="primary-text" *ngIf="!selectedFile"
              >Drag & Drop your file here</span
            >
            <span class="primary-text" *ngIf="selectedFile">{{
              selectedFile.name
            }}</span>
            <span class="secondary-text">or click to browse</span>
          </div>
        </div>
        <input
          #fileInput
          id="fileInput"
          type="file"
          class="file-input"
          (change)="onFileSelected($event)"
          accept=".png,.jpg,.jpeg,.webp"
        />
      </div>
      <div
        class="error"
        *ngIf="
          !selectedFile &&
          (uploadForm.get('documentType')?.touched || responseMessage)
        "
      >
        ‚ö†Ô∏è Please select a valid file (.png, .jpg, .jpeg, .webp, under 10MB).
      </div>
    </div>

    <!-- File Preview Section -->
    <div class="file-preview-section" *ngIf="selectedFile">
      <div class="preview-container">
        <!-- Image preview with fallback -->
        <img
          *ngIf="filePreviewUrl"
          [src]="filePreviewUrl"
          [alt]="selectedFile.name"
          class="preview-image"
          (error)="onImageError($event)"
        />
        <!-- Fallback if image fails to load -->
        <div *ngIf="!filePreviewUrl" class="preview-placeholder">
          <div class="placeholder-icon">üñºÔ∏è</div>
          <span>Preview not available</span>
        </div>

        <div class="file-info">
          <div class="file-details">
            <span class="file-name">{{ selectedFile.name }}</span>
            <span class="file-size">{{
              formatFileSize(selectedFile.size)
            }}</span>
            <span class="file-type">{{ selectedFile.type }}</span>
          </div>
          <button
            type="button"
            class="remove-file-btn"
            (click)="removeSelectedFile()"
            title="Remove file"
          >
            ‚ùå
          </button>
        </div>
      </div>
    </div>

    <!-- Document Type -->
    <div class="form-group">
      <select formControlName="documentType" class="dropdown-select">
        <option value="">-- Select Document Type --</option>
        <option *ngFor="let type of documentTypes" [value]="type.id">
          {{ type.name }}
        </option>
      </select>
      <div
        class="error"
        *ngIf="
          uploadForm.get('documentType')?.touched &&
          uploadForm.get('documentType')?.invalid
        "
      >
        ‚ö†Ô∏è Please select a document type.
      </div>
    </div>

    <!-- Submit -->
    <button
      class="upload-btn"
      type="submit"
      [disabled]="loading || !isFormValid()"
    >
      <span *ngIf="!loading">Submit</span>
      <span *ngIf="loading" class="loader"></span>
    </button>
  </form>

  <div
    *ngIf="responseMessage"
    class="response-card"
    [ngClass]="{ success: isSuccess, error: !isSuccess }"
  >
    <h3>{{ isSuccess ? "‚úÖ Upload Successful!" : "‚ùå Upload Failed" }}</h3>
    <p>{{ responseMessage }}</p>
    <div *ngIf="isSuccess && uploadResponse" class="response-details">
      <h4>üìÑ Document Details</h4>
      <ul>
        <li><strong>ID:</strong> {{ uploadResponse.documentId }}</li>
        <li><strong>File Name:</strong> {{ uploadResponse.fileName }}</li>
        <li>
          <strong>Classified Document Type:</strong>
          {{ uploadResponse.classifiedDocumentType }}
        </li>
        <li><strong>Status:</strong> {{ uploadResponse.status }}</li>
        <li>
          <strong>Size:</strong>
          {{ uploadResponse.fileSize / (1024 * 1024) | number : "1.2-2" }} MB
        </li>
      </ul>
      <div *ngIf="uploadResponse.extractedData">
        <h4>üßæ Extracted Data</h4>
        <ul>
          <li *ngIf="uploadResponse.extractedData.fullName">
            <strong>Name:</strong> {{ uploadResponse.extractedData.fullName }}
          </li>
          <li *ngIf="uploadResponse.extractedData.dateOfBirth">
            <strong>DOB:</strong>
            {{ uploadResponse.extractedData.dateOfBirth | date }}
          </li>
          <li *ngIf="uploadResponse.extractedData.gender">
            <strong>Gender:</strong> {{ uploadResponse.extractedData.gender }}
          </li>
          <li *ngIf="uploadResponse.extractedData.aadhaarNumber">
            <strong>Aadhaar:</strong>
            {{ uploadResponse.extractedData.aadhaarNumber }}
          </li>
          <li *ngIf="uploadResponse.extractedData.panNumber">
            <strong>PAN:</strong> {{ uploadResponse.extractedData.panNumber }}
          </li>
          <li *ngIf="uploadResponse.extractedData.passportNumber">
            <strong>Passport:</strong>
            {{ uploadResponse.extractedData.passportNumber }}
          </li>
          <li *ngIf="uploadResponse.extractedData.address">
            <strong>Address:</strong> {{ uploadResponse.extractedData.address }}
          </li>
          <li *ngIf="uploadResponse.extractedData.city">
            <strong>City:</strong> {{ uploadResponse.extractedData.city }}
          </li>
          <li *ngIf="uploadResponse.extractedData.state">
            <strong>State:</strong> {{ uploadResponse.extractedData.state }}
          </li>
          <li *ngIf="uploadResponse.extractedData.pinCode">
            <strong>Pin Code:</strong>
            {{ uploadResponse.extractedData.pinCode }}
          </li>
          <li>
            <strong>Confidence:</strong>
            {{ uploadResponse.extractedData.extractionConfidence }}%
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
